{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Session Metadata",
  "description": "Metadata for a Bucika GSR recording session",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version"
    },
    "devices": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/DeviceInfo"
      }
    },
    "events": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/SessionEvent"
      }
    },
    "files": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/SessionFile"
      }
    },
    "startTime": {
      "type": ["string", "null"],
      "format": "date-time"
    },
    "endTime": {
      "type": ["string", "null"],
      "format": "date-time"
    },
    "offsets": {
      "type": "object",
      "additionalProperties": {
        "type": "array",
        "items": {
          "$ref": "#/definitions/TimeOffset"
        }
      }
    }
  },
  "required": ["version", "devices", "events", "files"],
  "definitions": {
    "DeviceInfo": {
      "type": "object",
      "properties": {
        "deviceId": {"type": "string"},
        "deviceName": {"type": "string"},
        "capabilities": {"type": "array", "items": {"type": "string"}},
        "batteryLevel": {"type": "integer", "minimum": 0, "maximum": 100},
        "version": {"type": "string"},
        "role": {"type": ["string", "null"]}
      },
      "required": ["deviceId", "deviceName", "capabilities", "batteryLevel", "version"]
    },
    "SessionEvent": {
      "type": "object",
      "properties": {
        "type": {"type": "string"},
        "timestamp": {"type": "string", "format": "date-time"},
        "data": {"type": "object"}
      },
      "required": ["type", "timestamp"]
    },
    "SessionFile": {
      "type": "object",
      "properties": {
        "fileName": {"type": "string"},
        "fileSize": {"type": "integer", "minimum": 0},
        "checksum": {"type": "string"},
        "deviceId": {"type": "string"},
        "uploadedAt": {"type": "string", "format": "date-time"}
      },
      "required": ["fileName", "fileSize", "checksum", "deviceId", "uploadedAt"]
    },
    "TimeOffset": {
      "type": "object",
      "properties": {
        "timestamp": {"type": "string", "format": "date-time"},
        "offsetMs": {"type": "number"},
        "uncertainty": {"type": "number"}
      },
      "required": ["timestamp", "offsetMs", "uncertainty"]
    }
  }
}